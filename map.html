---
layout: page
title: "Map"
description: "The route so far, updated nightly"
header-img: "img/IMG_20150521_201020.jpg"
---

<style type="text/css">
    html, body, #map-canvas { height: 500px; margin: 0; padding: 0;}
</style>

<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?libraries=geometry&key=AIzaSyCFgDopYb6dFRv8NAycFYLYnwPOaCeRHws"></script>
<script type="text/javascript" src="/js/moment.js"></script>
<script type="text/javascript">
    function initialize() {
        var mapOptions = {
            center: { lat: 39, lng: -95},
            zoom: 4,
            mapTypeId: google.maps.MapTypeId.TERRAIN
        };
        var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

        var xmlhttp = new XMLHttpRequest();
        var url = "/stravaDump.json";

        xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                var stravaDump = JSON.parse(xmlhttp.responseText);
                appendRoute(stravaDump, map);
            }
        }
        xmlhttp.open("GET", url, true);
        xmlhttp.send();

    }
    google.maps.event.addDomListener(window, 'load', initialize);

    var endpointMarkers = [];
    function appendRoute(stravaDump, map) {
        var endpoints = [];
        for (var rideDate in stravaDump.rides) {
            var ridePath = new google.maps.Polyline({
                path: google.maps.geometry.encoding.decodePath(stravaDump.rides[rideDate].map.summary_polyline),
                map: map,
                geodesic: true,
                strokeColor: '#FF0000',
                strokeOpacity: 1.0,
                strokeWeight: 2
            });

            var rideJustDate = rideDate.substring(0, 10);
            if (endpoints[rideJustDate]) {
                if (moment(rideDate) > moment(endpoints[rideJustDate].date)) {
                    endpoints[rideJustDate] = {
                        date: rideDate,
                        endpoint: stravaDump.rides[rideDate].end_latlng,
                    }
                }
            }
            else {
                endpoints[rideJustDate] = {
                    date: rideDate,
                    endpoint: stravaDump.rides[rideDate].end_latlng,
                }
            }
        }

        for (justDate in endpoints) {
            var endLatLng = new google.maps.LatLng(endpoints[justDate].endpoint[0], endpoints[justDate].endpoint[1]);
            var endMarker = new google.maps.Marker({
                position: endLatLng,
                map: map,
                visible: false,
            });
            endpointMarkers.push(endMarker);
        }
    }

    function toggleMarkers(show) {
        for (marker in endpointMarkers) {
            endpointMarkers[marker].setVisible(show);
        }
    }
</script>
<div id="map-canvas"></div>
<form>
    <input type="checkbox" onclick="toggleMarkers(this.checked)"><span style="font-size: 14px">&nbspShow overnight stops</span></input>
</form>

